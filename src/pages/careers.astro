---
import BaseLayout from "../layouts/BaseLayout.astro";
import Icon from "../components/Icon.astro";

const metadata = {
    title: "Careers - The Valley Clean Team",
    description:
        "Join The Valley Clean Team! We're looking for dedicated professionals to provide luxury cleaning services in Alabama and Tennessee.",
};
---

<BaseLayout title={metadata.title} description={metadata.description}>
    <!-- Hero Section -->
    <section
        class="relative py-20 bg-gradient-to-br from-[#333333] to-[#444444] text-white"
    >
        <div class="container mx-auto px-6 relative z-10 text-center">
            <h1 class="font-playfair text-4xl md:text-5xl font-bold mb-4">
                Join Our Team
            </h1>
            <p class="text-xl max-w-2xl mx-auto text-gray-300">
                We're looking for dedicated, detail-oriented professionals who
                take pride in their work to join The Valley Clean Team.
            </p>
        </div>
    </section>

    <!-- Application Form Section -->
    <section class="py-16 px-6 bg-gray-50">
        <div class="container mx-auto max-w-3xl">
            <div
                class="bg-white rounded-2xl p-8 xl:p-12 shadow-sm border border-gray-100"
            >
                <h2
                    class="font-playfair text-3xl font-bold mb-6 text-[#333333]"
                >
                    Employment Application
                </h2>
                <p class="text-gray-600 mb-8">
                    Please fill out the form below to apply for a position. We
                    actively review all applications and will get back to you
                    shortly.
                </p>

                <form id="careerForm" class="space-y-6">
                    <div
                        id="formMessage"
                        class="hidden p-4 rounded-xl mb-6 text-center font-medium"
                    >
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label
                                for="firstName"
                                class="block text-sm font-medium text-gray-700 mb-2"
                                >First Name *</label
                            >
                            <input
                                type="text"
                                id="firstName"
                                name="firstName"
                                required
                                class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-[#FFA985] focus:border-[#FFA985] outline-none transition"
                            />
                        </div>
                        <div>
                            <label
                                for="lastName"
                                class="block text-sm font-medium text-gray-700 mb-2"
                                >Last Name *</label
                            >
                            <input
                                type="text"
                                id="lastName"
                                name="lastName"
                                required
                                class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-[#FFA985] focus:border-[#FFA985] outline-none transition"
                            />
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label
                                for="email"
                                class="block text-sm font-medium text-gray-700 mb-2"
                                >Email Address *</label
                            >
                            <input
                                type="email"
                                id="email"
                                name="email"
                                required
                                class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-[#FFA985] focus:border-[#FFA985] outline-none transition"
                            />
                        </div>
                        <div>
                            <label
                                for="phone"
                                class="block text-sm font-medium text-gray-700 mb-2"
                                >Phone Number *</label
                            >
                            <input
                                type="tel"
                                id="phone"
                                name="phone"
                                required
                                class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-[#FFA985] focus:border-[#FFA985] outline-none transition"
                            />
                        </div>
                    </div>

                    <div>
                        <label
                            for="address"
                            class="block text-sm font-medium text-gray-700 mb-2"
                            >Address *</label
                        >
                        <input
                            type="text"
                            id="address"
                            name="address"
                            required
                            class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-[#FFA985] focus:border-[#FFA985] outline-none transition mb-3"
                            placeholder="Street Address"
                        />

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                            <input
                                type="text"
                                id="city"
                                name="city"
                                required
                                placeholder="City"
                                class="w-full md:col-span-1 px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-[#FFA985] focus:border-[#FFA985] outline-none transition"
                            />
                            <input
                                type="text"
                                id="state"
                                name="state"
                                required
                                placeholder="State"
                                class="w-full md:col-span-1 px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-[#FFA985] focus:border-[#FFA985] outline-none transition"
                            />
                            <input
                                type="text"
                                id="zip"
                                name="zip"
                                required
                                placeholder="ZIP Code"
                                class="w-full md:col-span-1 px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-[#FFA985] focus:border-[#FFA985] outline-none transition"
                            />
                        </div>
                    </div>

                    <div>
                        <label
                            for="experience"
                            class="block text-sm font-medium text-gray-700 mb-2"
                            >Professional Cleaning Experience *</label
                        >
                        <select
                            id="experience"
                            name="experience"
                            required
                            class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-[#FFA985] focus:border-[#FFA985] outline-none transition bg-white"
                        >
                            <option value="" disabled selected
                                >Select experience level...</option
                            >
                            <option value="None">None - Willing to learn</option
                            >
                            <option value="Less than 1 year"
                                >Less than 1 year</option
                            >
                            <option value="1-3 years">1-3 years</option>
                            <option value="3-5 years">3-5 years</option>
                            <option value="5+ years">5+ years</option>
                        </select>
                    </div>

                    <div>
                        <label class="flex items-center space-x-3 mb-3">
                            <input
                                type="checkbox"
                                name="reliableTransportation"
                                value="Yes"
                                required
                                class="w-5 h-5 text-[#FFA985] border-gray-300 rounded focus:ring-[#FFA985]"
                            />
                            <span class="text-sm text-gray-700"
                                >I have a reliable vehicle and a valid driver's
                                license. *</span
                            >
                        </label>
                        <label class="flex items-center space-x-3">
                            <input
                                type="checkbox"
                                name="backgroundCheck"
                                value="Yes"
                                required
                                class="w-5 h-5 text-[#FFA985] border-gray-300 rounded focus:ring-[#FFA985]"
                            />
                            <span class="text-sm text-gray-700"
                                >I am willing to undergo a background check. *</span
                            >
                        </label>
                    </div>

                    <div>
                        <label
                            for="whyJoin"
                            class="block text-sm font-medium text-gray-700 mb-2"
                            >Why would you like to join The Valley Clean Team?</label
                        >
                        <textarea
                            id="whyJoin"
                            name="whyJoin"
                            rows="4"
                            class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-[#FFA985] focus:border-[#FFA985] outline-none transition"
                        ></textarea>
                    </div>

                    <button
                        type="submit"
                        id="submitBtn"
                        class="w-full bg-gradient-to-r from-[#FFA985] to-[#FFC67D] hover:from-[#FF8C61] hover:to-[#FFB366] text-[#333333] px-8 py-4 rounded-xl font-bold text-lg transition shadow-lg flex items-center justify-center disabled:opacity-75 disabled:cursor-not-allowed"
                    >
                        <Icon name="paper-plane" class="w-5 h-5 mr-2" />
                        <span id="btnText">Submit Application</span>
                    </button>
                </form>
            </div>
        </div>
    </section>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const form = document.getElementById(
                "careerForm",
            ) as HTMLFormElement;
            const submitBtn = document.getElementById(
                "submitBtn",
            ) as HTMLButtonElement;
            const btnText = document.getElementById("btnText");
            const formMessage = document.getElementById("formMessage");

            if (!form || !submitBtn || !btnText || !formMessage) return;

            form.addEventListener("submit", async (e) => {
                e.preventDefault();

                // Show loading state
                submitBtn.disabled = true;
                btnText.textContent = "Submitting...";
                formMessage.classList.add("hidden");

                const formData = new FormData(form);

                // Construct the payload for our n8n endpoint
                // We map all fields into the expected structure, dumping extra into 'notes'
                const payload = {
                    name: `${formData.get("firstName")} ${formData.get("lastName")}`,
                    email: formData.get("email"),
                    phone: formData.get("phone"),
                    source: "Career Application",
                    service: "Employment Application",
                    location: `${formData.get("city")}, ${formData.get("state")} ${formData.get("zip")}`,
                    page_url: window.location.href,
                    message: `Address: ${formData.get("address")}, ${formData.get("city")}, ${formData.get("state")} ${formData.get("zip")}
Experience: ${formData.get("experience")}
Reliable Transportation/License: ${formData.get("reliableTransportation") ? "Yes" : "No"}
Willing to undergo background check: ${formData.get("backgroundCheck") ? "Yes" : "No"}

Why join the team:
${formData.get("whyJoin")}`,
                };

                try {
                    const response = await fetch("/api/submit-form", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify(payload),
                    });

                    const data = await response.json();

                    if (response.ok) {
                        // Success state
                        formMessage.textContent =
                            "Thank you for your application! We will review it and get back to you shortly.";
                        formMessage.className =
                            "p-4 rounded-xl mb-6 text-center font-medium bg-green-50 text-green-700 border border-green-200";
                        form.reset();

                        // Redirect to thank you page after 2 seconds
                        setTimeout(() => {
                            window.location.href = "/thank-you";
                        }, 2000);
                    } else {
                        throw new Error(data.message || "Something went wrong");
                    }
                } catch (error) {
                    // Error state
                    formMessage.textContent =
                        "Sorry, there was an error submitting your application. Please try again.";
                    formMessage.className =
                        "p-4 rounded-xl mb-6 text-center font-medium bg-red-50 text-red-700 border border-red-200";
                } finally {
                    // Reset button
                    submitBtn.disabled = false;
                    btnText.textContent = "Submit Application";
                }
            });
        });
    </script>
</BaseLayout>
